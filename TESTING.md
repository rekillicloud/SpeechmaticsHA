# Инструкции по тестированию Speechmatics STT компонента

## Предварительные требования

1. Установленный и запущенный Home Assistant
2. API ключ от Speechmatics
3. Настроенный микрофон или аудио источник
4. Настроенные LLM и TTS компоненты в пайплайне

## Шаг 1: Установка компонента

1. Скопируйте папку `custom_components/speechmatics_stt` в директорию `custom_components` вашего Home Assistant
2. Перезапустите Home Assistant
3. Проверьте логи на наличие ошибок загрузки

## Шаг 2: Конфигурация через UI

1. Перейдите в **Настройки** → **Устройства и службы**
2. Нажмите **Добавить интеграцию**
3. Найдите "Speechmatics STT"
4. Введите API ключ
5. Выберите язык (например, `ru` для русского)
6. Настройте `operating_point` (enhanced или standard)
7. Настройте `max_delay` (рекомендуется 0.8)
8. Сохраните конфигурацию

## Шаг 3: Проверка entity

1. Перейдите в **Настройки** → **Устройства и службы** → **STT**
2. Убедитесь, что появилась entity "Speechmatics STT"
3. Проверьте, что состояние `available`

## Шаг 4: Интеграция в Assist Pipeline

1. Перейдите в **Настройки** → **Голосовые помощники** → **Assist**
2. Выберите или создайте пайплайн
3. В разделе **STT** выберите "Speechmatics STT"
4. Убедитесь, что LLM и TTS настроены
5. Сохраните конфигурацию

## Шаг 5: Тестирование транскрипции

### Тест 1: Базовое распознавание

1. Активируйте голосового помощника (wake word или кнопка)
2. Произнесите простую фразу на выбранном языке
3. Проверьте, что:
   - Аудио записывается
   - Транскрипт появляется
   - LLM получает текст
   - TTS воспроизводит ответ

### Тест 2: Разные языки

1. Измените язык в конфигурации
2. Перезапустите Home Assistant
3. Протестируйте распознавание на новом языке

### Тест 3: Обработка ошибок

1. Временно введите неверный API ключ
2. Проверьте, что entity переходит в состояние `unavailable`
3. Восстановите правильный ключ
4. Проверьте, что entity снова доступна

## Шаг 6: Проверка логов

Включите отладочное логирование:

```yaml
logger:
  default: info
  logs:
    custom_components.speechmatics_stt: debug
```

Проверьте логи на наличие:
- Успешных подключений к Speechmatics API
- Полученных транскриптов
- Ошибок (если есть)

## Ожидаемое поведение

### Успешная транскрипция:
- В логах появляются сообщения "Processing audio stream"
- Появляется "Received final transcript: [текст]"
- Текст передается в LLM
- Ответ воспроизводится через TTS

### Ошибки:
- При неверном API ключе: "API key authentication failed"
- При проблемах сети: "Connection error" или "Connection timeout"
- При таймауте: "Timeout waiting for final transcript"

## Устранение проблем

### Нет транскрипции:
1. Проверьте логи на ошибки
2. Убедитесь, что API ключ правильный
3. Проверьте сетевое соединение
4. Убедитесь, что формат аудио поддерживается

### Большая задержка:
1. Уменьшите `max_delay` до 0.5
2. Используйте `operating_point: standard`
3. Проверьте скорость интернет-соединения

### Entity unavailable:
1. Проверьте API ключ
2. Проверьте логи на ошибки аутентификации
3. Перезапустите Home Assistant

## Производительность

Ожидаемые метрики:
- Задержка транскрипции: 0.5-2 секунды (зависит от `max_delay` и `operating_point`)
- Точность: зависит от языка и качества аудио
- Поддержка длинных фраз: до нескольких минут непрерывной речи
